<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
<!ENTITY name        "compose.manager">
<!ENTITY author      "mstrhakr">
<!ENTITY version     "2026.02.08">
<!ENTITY launch      "Settings/&name;">
<!ENTITY packageVER  "&version;">
<!ENTITY packageMD5  "20690dd3cf2dd0d22f1f3f16918ccd54">
<!ENTITY packageName "&name;-package-&packageVER;">
<!ENTITY packagefile "&packageName;.txz">
<!ENTITY github      "mstrhakr/compose_plugin">
<!ENTITY pluginURL   "https://raw.githubusercontent.com/&github;/main/&name;.plg">
<!ENTITY packageURL  "https://github.com/&github;/releases/download/v&version;/&packagefile;">
<!ENTITY pluginLOC   "/boot/config/plugins/&name;">
<!ENTITY emhttpLOC   "/usr/local/emhttp/plugins/&name;">
]>

<PLUGIN  name="&name;"
         author="&author;"
         version="&version;"
         launch="&launch;"
         pluginURL="&pluginURL;"
         icon="cubes"
         min="6.9.0"
         support="https://github.com/mstrhakr/compose_plugin/issues"
         project="https://github.com/mstrhakr/compose_plugin"
         readme="https://github.com/mstrhakr/compose_plugin#readme"
>

<CHANGES>
###2026.02.09
- Features: Implement filtering for compose-managed containers
  - Added functionality to optionally hide compose-managed containers in DockerClient and DockerContainers.
  - Introduced configuration option HIDE_COMPOSE_FROM_DOCKER to control visibility of compose-managed containers.
  - Updated Docker system scripts to respect the new configuration setting.
  - Enhanced DockerClient to include additional metadata for containers, such as Icon, Url, Shell, and Manager.
  - Created patch.sh script for robust patch management, allowing for easy application and removal of patches.
  - Added unit tests for the new filtering logic and settings page to ensure correct behavior.
- Features: hide compose containers from Docker tile on Dashboard
  - Add HIDE_DOCKER_COMPOSE_CONTAINERS setting (default: false)
  - Collect container names from compose stacks in dashboard_stacks.php
  - Hide matching containers using ajaxComplete + CSS !important class
  - Grey out option when Show Dashboard Tile is disabled
- Features: add option to display Compose stacks above Docker Containers
  - Add SHOW_COMPOSE_ON_TOP config with default 'false'
  - Add settings toggle with dependency on Header Menu setting
  - Add DOM reorder logic in compose_manager_main.php that moves
- Bug Fixes: update patch file to skip disabling compose containers
- Fix dashboard visual bugs: dynamic flex layout, SHA display, CSS class collision
  - Replace fixed-width CSS columns with dynamic flexbox layout (name flex:1, cols flex:2)
  - Remove --compose-name-width and --compose-image-width CSS variables
  - Fix SHA display stripping sha256: prefix before truncating to 8 hex chars
  - Rename CSS class from 'info' to 'containers' to avoid Unraid global .info collision
  - Add min-width:0 and overflow:hidden to flex containers for proper truncation
  - Set update column to 120px, runtime to 100px with 12px right padding
  - Remove spacer column, use flex-grow for container image column
- Update settings page to clarify option for hiding Compose containers from Docker UI
- Fix formatting and improve readability in settings page
- [View all changes](https://github.com/mstrhakr/compose_plugin/compare/v2026.02.08...v2026.02.09)
###2026.02.08
- Features: enable blank issues and add feature request template for contributions
- Features: add issues section to issue template configuration
- Features: add issue and pull request templates for better contribution guidelines
- Features: create initial override file for UI labels if it doesn't exist and remove old modal for editing the override file
- Bug Fixes: enhance UI feedback with localized spinners and status icons for compose actions
- Bug Fixes: include --all flag in docker compose commands to return exited/stopped containers
- Bug Fixes: improve switch button initialization and ensure consistent label alignment
- Bug Fixes: enhance switchButton initialization to prevent re-binding and ensure consistent state
- Bug Fixes: replace outdated bug report template with a new structured format
- Bug Fixes: remove outdated bug report template from issue configuration
- Bug Fixes: correct name field in bug report template
- Bug Fixes: standardize quotes and formatting in bug report template
- Bug Fixes: add quotes around bug report name
- Bug Fixes: remove title field from bug report template
- Bug Fixes: correct placeholder syntax in bug report template title
- Bug Fixes: update support forum URL in issue template configuration
- Bug Fixes: ensure text coverage report is generated in phpunit configuration
- Bug Fixes: add workspace instructions file to .gitignore
- Chores: remove outdated bug report and feature request templates
- Update issue templates by adding bug report template from webui
- [View all changes](https://github.com/mstrhakr/compose_plugin/compare/v2026.02.03d...v2026.02.08)

</CHANGES>

<!-- The 'pre-install' script. -->
<FILE Run="/bin/bash">
<INLINE>
# Remove old 'source' files
rm -f $(ls &pluginLOC;/&name;*.txz 2>/dev/null|grep -v '&packageVER;')

#Create projects folder if it doesnt exist
mkdir -p &pluginLOC;/projects

if [[ ! -f "&pluginLOC;/projects/version" ]]; then
    #Upgrade projects to latest format
    for dir in &pluginLOC;/projects/*; do
        if [[ -d $dir ]]; then
            if [[ -f $dir/compose.yml ]]; then
                mv $dir/compose.yml $dir/docker-compose.yml
            fi
        fi
    done

    echo "1" > &pluginLOC;/projects/version
fi

#Add SHOW_COMPOSE_IN_HEADER_MENU entry if not exists
grep -q "SHOW_COMPOSE_IN_HEADER_MENU=" &pluginLOC;/&name;.cfg || echo "SHOW_COMPOSE_IN_HEADER_MENU=\"false\"" &gt;&gt; &pluginLOC;/&name;.cfg

</INLINE>
</FILE>

<FILE Name="&pluginLOC;/&packagefile;" Run="upgradepkg --install-new">
<URL>&packageURL;</URL>
<MD5>&packageMD5;</MD5>
</FILE> 

<FILE Run="/bin/bash">
<INLINE>
# Use the new patch utility during install to cleanup and optionally apply patches
patch_script=/usr/local/emhttp/plugins/compose.manager/scripts/patch.sh
config_file=/boot/config/plugins/compose.manager/compose.manager.cfg
if [ -f "$patch_script" ]; then
    if [ -f "$config_file" ]; then
        #Grab the contents of our config file.
        source &lt;(grep = $config_file)
        patch_ui=${PATCH_UI:='false'}
        hide_compose=${HIDE_COMPOSE_FROM_DOCKER:='false'}

        # Ensure any previously applied patches are removed first (cleanup)
        $patch_script -r 2>/dev/null || true

        if [ $patch_ui == 'true' ]; then
            echo ""
            echo "----------------------------------------------------"
            echo " Applying WebUI Patches..."
            echo "----------------------------------------------------"
            echo ""
            #Remove patchs if already applied
            $patch_script -r

            #Apply Patches
            $patch_script
        fi
        # If the 'hide compose from docker' setting is enabled, auto-apply patches now
        if [ "$hide_compose" == 'true' ]; then
            echo ""
            echo "----------------------------------------------------"
            echo " Applying WebUI Patches because HIDE_COMPOSE_FROM_DOCKER=true"
            echo "----------------------------------------------------"
            echo ""
            $patch_script apply || true
        fi
    fi
fi
</INLINE>
</FILE>

<FILE Run="/bin/bash">
<INLINE>
echo ""
echo "----------------------------------------------------"
echo " &name; has been installed."
echo " Version: &version;"
echo "----------------------------------------------------"
echo ""
</INLINE>
</FILE>

<FILE Run="/bin/bash" Method="remove">
<INLINE>
#Remove patchs if already applied
patch_remove_script=/usr/local/emhttp/plugins/compose.manager/scripts/patch_ui.sh
patch_remove_script=/usr/local/emhttp/plugins/compose.manager/scripts/patch.sh
if [ -f "$patch_remove_script" ]; then
    $patch_remove_script -r
fi

removepkg &packageName;

# Remove plugin related files
rm -f $(ls &pluginLOC;/&name;*.txz 2>/dev/null|grep -v '&packageVER;')
</INLINE>
</FILE> 

</PLUGIN>

